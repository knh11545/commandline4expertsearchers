#!/bin/env sh
# Convert a list of PubMed-IDs (PMIDs) to a search string for Ovid MEDLINE
# 
# Either the name of a file containing the PMIDs can be given as an argument 
# or the list of PMIDs will be read from STDIN.
# 
# Each PMID must be on an individual line.
# 
# Input is not checked for correct PMIDs but whitespace at beginning 
# or end of lines as well as empty lines will be deleted.
#
# Output will be writen to STDOUT.
#
# Author: Helge Knüttel, <helge.knuettel@ur.de>
# Date: 2020

# Fields to search for in Ovid
# This is the part in between the periods in a search statement.
OVID_FIELD_LIST=ui

if test -n "$1" ; then
    PMID_FILE=$1
else
    PMID_FILE=-
fi

if ! test -r "$PMID_FILE" ; then
    >&2 echo "Cannot read from file \"${PMID_FILE}\". Abort!"
    exit 1
fi

# Steps: 
#  * Delete empty lines or lines containig only whitespace.
#  * Add '"' to beginning of each line of the input.
#  * Add '"' to end of each line of the input.
#    Whitespace at beginning or end of line will be deleted.
#  * Add ' OR ' to end of each line except the last one.
#  * Add "(" to beginning of file
#  * Add ")" and field specification to end of file
cat "${PMID_FILE}" | \
sed\
  -e '/^\s*$/d' | \
sed\
  -e 's/^\s*/"/' \
  -e 's/\s*$/"/' \
  -e '$! s/$/ OR /' | \
sed\
  -e '1 i (' \
  -e "\$ a ).${OVID_FIELD_LIST}."

