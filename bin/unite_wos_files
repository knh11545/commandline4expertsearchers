#!/usr/bin/env bash 
# unite_wos_files: Unite files exported from Web of Science
# 
# Web of Science allows to export bibliographic records only in portions of up to 500 records. This script will unite such files into a single one.
#
# Usage: unite_wos_files FILE [...]
# 
# Output is written to STDOUT.
#
# Author: Helge Knüttel
# Date: 2019-2020

# Some sensible settings. Taken from https://kvz.io/bash-best-practices.html
set -o errexit  # exit when a command fails
set -o pipefail # catch failing commands in a pipe
set -o nounset  # exit when script tries to use undeclared variables
# set -o xtrace # Trace what gets executed. Useful for debugging.


HEADER="FN Clarivate Analytics Web of Science"
VERSION="VR 1.0"
ENDOFFILE="EF"

# Add UTF-8 byte order mark
printf '\xEF\xBB\xBF%s\n' "$HEADER"
printf '%s\n'  "$VERSION"

for file in "$@"
do
	# There may be a byte-order mark before the header
	sed -e "/${HEADER}/d" -e "/^${VERSION}/d" -e "/^${ENDOFFILE}/d" "$file"
done

printf '%s' "$ENDOFFILE"

